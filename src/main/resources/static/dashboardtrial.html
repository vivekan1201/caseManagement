<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="">
    <meta name="author" content="Tooplate">

    <title>Insight Advantage</title>

    <!-- CSS FILES -->
    <link rel="preconnect" href="https://fonts.googleapis.com">

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@300;400;700&display=swap" rel="stylesheet">

    <link href="css/bootstrap.min.css" rel="stylesheet">

    <link href="css/bootstrap-icons.css" rel="stylesheet">

    <link rel="stylesheet" href="css/apexcharts.css">

    <link href="css/tooplate-mini-finance.css" rel="stylesheet">

    <link href="css/dashboard.css" rel="stylesheet">
    <link href="css/todo.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!--

    Tooplate 2135 Mini Finance

    https://www.tooplate.com/view/2135-mini-finance

    Bootstrap 5 Dashboard Admin Template

    -->

    <style>
        .custom-block.chart-specific {
           width: 100%; /* Adjust width for this block */
           margin: 0 auto; /* Center the block */
           border: 1px solid #ddd; /* Optional border */
           border-radius: 8px; /* Optional rounded corners */
           box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Subtle shadow */
           height: 35%;

       }

       #chart-container {
           width: 100%;

           height: auto;
           text-align: center;
       }

       canvas {
           max-width: 100%;
           height: auto; /* Responsive chart resizing */
       }
    </style>

</head>

<body>
<header class="navbar sticky-top flex-md-nowrap">
    <div class="col-md-3 col-lg-3 me-0 px-3 fs-6">
        <a class="navbar-brand" href="index.html">
            <i class="bi-box"></i>
            Insights
        </a>
    </div>

    <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <form class="custom-form header-form ms-lg-3 ms-md-3 me-lg-auto me-md-auto order-2 order-lg-0 order-md-0 d-flex"
          action="search.html"
          method="get"
          role="form">
        <input class="form-control me-2" name="search" type="text" placeholder="Search" aria-label="Search" required>
        <button type="submit" class="btn btn-primary">Search</button>
    </form>



            <div class="dropdown ps-1">
                <a class="nav-link dropdown-toggle text-center" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi-three-dots-vertical"></i>
                </a>

                <div class="dropdown-menu dropdown-menu-social bg-white shadow">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-4 col-md-4 col-4">
                                <a class="dropdown-item text-center" href="#">
                                    <img src="images/social/search.png" class="profile-image img-fluid" alt="">
                                    <span class="d-block">Google</span>
                                </a>
                            </div>

                            <div class="col-lg-4 col-md-4 col-4">
                                <a class="dropdown-item text-center" href="#">
                                    <img src="images/social/spotify.png" class="profile-image img-fluid" alt="">
                                    <span class="d-block">Spotify</span>
                                </a>
                            </div>

                            <div class="col-lg-4 col-md-4 col-4">
                                <a class="dropdown-item text-center" href="#">
                                    <img src="images/social/telegram.png" class="profile-image img-fluid" alt="">
                                    <span class="d-block">Telegram</span>
                                </a>
                            </div>

                            <div class="col-lg-4 col-md-4 col-4">
                                <a class="dropdown-item text-center" href="#">
                                    <img src="images/social/snapchat.png" class="profile-image img-fluid" alt="">
                                    <span class="d-block">Snapchat</span>
                                </a>
                            </div>

                            <div class="col-lg-4 col-md-4 col-4">
                                <a class="dropdown-item text-center" href="#">
                                    <img src="images/social/tiktok.png" class="profile-image img-fluid" alt="">
                                    <span class="d-block">Tiktok</span>
                                </a>
                            </div>

                            <div class="col-lg-4 col-md-4 col-4">
                                <a class="dropdown-item text-center" href="#">
                                    <img src="images/social/youtube.png" class="profile-image img-fluid" alt="">
                                    <span class="d-block">Youtube</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dropdown px-3">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <img src="images/medium-shot-happy-man-smiling.jpg" class="profile-image img-fluid" alt="">
                </a>
                <ul class="dropdown-menu bg-white shadow">
                    <li>
                        <div class="dropdown-menu-profile-thumb d-flex">
                            <img src="images/medium-shot-happy-man-smiling.jpg" class="profile-image img-fluid me-3" alt="">

                            <div class="d-flex flex-column">
                                <small>Thomas</small>
                                <a href="#">thomas@site.com</a>
                            </div>
                        </div>
                    </li>

                    <li>
                        <a class="dropdown-item" href="profile.html">
                            <i class="bi-person me-2"></i>
                            Profile
                        </a>
                    </li>

                    <li>
                        <a class="dropdown-item" href="setting.html">
                            <i class="bi-gear me-2"></i>
                            Settings
                        </a>
                    </li>

                    <li>
                        <a class="dropdown-item" href="help-center.html">
                            <i class="bi-question-circle me-2"></i>
                            Help
                        </a>
                    </li>

                    <li class="border-top mt-3 pt-2 mx-4">
                        <a class="dropdown-item ms-0 me-0" href="#">
                            <i class="bi-box-arrow-left me-2"></i>
                            Logout
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</header>

<div class="container-fluid">
    <div class="row">
        <nav id="sidebarMenu" class="col-md-3 col-lg-3 d-md-block sidebar collapse">
            <div class="position-sticky py-4 px-3 sidebar-sticky">
                <ul class="nav flex-column h-100">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="dashboardtrial.html">
                            <i class="bi-house-fill me-2"></i>
                            Overview
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="Page1.html">
                            <i class="bi-wallet me-2"></i>
                            Calendar
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link active" href="addclient.html">
                            <i class="bi-wallet me-2"></i>
                            Add Client
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link active" href="client.html">
                            <i class="bi-wallet me-2"></i>
                            My Clients
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="addservice.html">
                            <i class="bi-house-fill me-2"></i>
                            Modify Service
                        </a>
                    </li>
                    <li class="nav-item border-top mt-auto pt-2">
                        <a class="nav-link" href="#">

                            <img src="girlsitting.svg" alt="Header Image" class="header-image" style="width: 400px; height: auto;">

                        </a>
                    </li>
                    <li class="nav-item border-top mt-auto pt-2">
                        <a class="nav-link" href="#">
                            <i class="bi-box-arrow-left me-2"></i>
                            Logout
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <main class="main-wrapper col-md-9 ms-sm-auto py-4 col-lg-9 px-md-4 border-start">
            <div class="title-group mb-3">
                <h3 class="h4 mb-0">Overview</h1>

                    <!-- <small class="text-muted">Hello Thomas, welcome back!</small> -->
            </div>

            <div class="row my-4">
                <div class="col-lg-7 col-12">
                    <div class="custom-block custom-block-balance">
                        <div class="col-lg-12 col-12">
                            <div class="custom-block bg-white">
                                <h5 class="mb-4">Recent Clients</h5>

                                <div class="table-responsive">
                                    <table class="account-table table">
                                        <thead>
                                        <tr>
                                            <th scope="col">Name</th>
                                            <th scope="col">Email</th>
                                            <th scope="col">Service</th>
                                            <th scope="col">Address</th>
                                            <th scope="col">Action</th>
                                        </tr>
                                        </thead>
                                        <tbody id="client-table-body">
                                        <!-- Dynamic rows will be inserted here -->
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Popup Overlay -->
                                <div class="popup-overlay" style="display: none;">
                                    <div class="popup-content">
                                        <div class="popup-header">
                                            <h5>Client Details</h5>
                                            <button class="popup-close">&times;</button>
                                        </div>
                                        <div id="popup-body">
                                            <!-- Dynamic popup content will be inserted here -->
                                        </div>
                                    </div>
                                </div>

<!--                                <nav aria-label="Page navigation example">-->
<!--                                    <ul class="pagination justify-content-center mb-0">-->
<!--                                        <li class="page-item">-->
<!--                                            <a class="page-link" href="#" aria-label="Previous">-->
<!--                                                <span aria-hidden="true">Prev</span>-->
<!--                                            </a>-->
<!--                                        </li>-->

<!--                                        <li class="page-item active" aria-current="page">-->
<!--                                            <a class="page-link" href="#">1</a>-->
<!--                                        </li>-->

<!--                                        <li class="page-item">-->
<!--                                            <a class="page-link" href="#">2</a>-->
<!--                                        </li>-->

<!--                                        <li class="page-item">-->
<!--                                            <a class="page-link" href="#">3</a>-->
<!--                                        </li>-->

<!--                                        <li class="page-item">-->
<!--                                            <a class="page-link" href="#">4</a>-->
<!--                                        </li>-->

<!--                                        <li class="page-item">-->
<!--                                            <a class="page-link" href="#" aria-label="Next">-->
<!--                                                <span aria-hidden="true">Next</span>-->
<!--                                            </a>-->
<!--                                        </li>-->
<!--                                    </ul>-->
<!--                                </nav>-->
                            </div>
                        </div>



                    </div>

<!--                    <div class="custom-block bg-white" style="padding: 24px !important;">-->
<!--                        <h5 class="mb-4">Regional Distribution of Clients</h5>-->

<!--&lt;!&ndash;                        <div id="pie-chart"></div>&ndash;&gt;-->
<!--                        <div id="chart-container">-->
<!--                            <canvas id="regionalPieChart"></canvas>-->
<!--                        </div>-->
<!--                    </div>-->
                    <div class="custom-block chart-specific" style="padding: 24px !important;">
                        <h5 class="mb-4">Regional Distribution of Clients</h5>
                        <div id="chart-container">
                            <canvas id="regionalPieChart"></canvas>
                        </div>
                    </div>




                </div>

                <div class="col-lg-5 col-12">
                    <div class="custom-block" style="height: 45%;">
                        <div id="calendar"></div>
                    </div>

                    <div class="custom-block custom-block-transations">
                        <div class="todoList">
                            <div class="cover-img">
                                <div class="cover-inner">
                                    <h3 id="dayName">Monday
                                    </h3>
                                </div>
                            </div>

                            <div class="content">

                                <ul class="todos align">


                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <footer class="site-footer">
                <div class="container">
                    <div class="row">

                        <div class="col-lg-12 col-12">
                            <p class="copyright-text">Copyright © Insights

                        </div>

                    </div>
                </div>
            </footer>
        </main>

    </div>
</div>

<!-- JAVASCRIPT FILES -->
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.bundle.min.js"></script>
<script src="js/apexcharts.min.js"></script>
<script src="js/custom.js"></script>

<!--<script type="text/javascript">-->
<!--    var options = {-->
<!--      series: [13, 43, 22],-->
<!--      chart: {-->
<!--      width: 380,-->
<!--      type: 'pie',-->
<!--    },-->
<!--    labels: ['Balance', 'Expense', 'Credit Loan',],-->
<!--    responsive: [{-->
<!--      breakpoint: 480,-->
<!--      options: {-->
<!--        chart: {-->
<!--          width: 200-->
<!--        },-->
<!--        legend: {-->
<!--          position: 'bottom'-->
<!--        }-->
<!--      }-->
<!--    }]-->
<!--    };-->

<!--    var chart = new ApexCharts(document.querySelector("#pie-chart"), options);-->
<!--    chart.render();-->
<!--</script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.5.1/moment.min.js"></script>
<script src="js/dashboardCalendar.js"></script>
<script src="js/todo.js"></script>
<script>
    async function fetchStaffAndClientData() {
        try {
            // Step 1: Fetch the staff name
            const staffResponse = await fetch('http://localhost:8080/api/getUsername');
            if (!staffResponse.ok) throw new Error('Failed to fetch staff name');
            const staffName = await staffResponse.text();

            // Step 2: Fetch the client data using the staff name
            const clientsResponse = await fetch(`http://localhost:8080/api/myclients?staff=${encodeURIComponent(staffName)}`);
            if (!clientsResponse.ok) throw new Error('Failed to fetch client data');
            const clients = await clientsResponse.json();

            // Step 3: Process client data to calculate regional distribution
            const regionCounts = {};
            clients.forEach(client => {
                const region = client.region;
                regionCounts[region] = (regionCounts[region] || 0) + 1;
            });

            // Step 4: Prepare data for the chart
            const labels = Object.keys(regionCounts);
            const data = Object.values(regionCounts);

            renderPieChart(labels, data);
        } catch (error) {
            console.error('Error:', error);
        }
    }

    function renderPieChart(labels, data) {
        const ctx = document.getElementById('regionalPieChart').getContext('2d');
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: ['#e63946', '#457b9d', '#a8dadc', '#f1faee', '#ffadad', '#90be6d'],
                    borderColor: '#ffffff',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.raw || 0;
                                return `${label}: ${value}`;
                            }
                        }
                    }
                },
                layout: {
                    padding: 10
                }
            }
        });
    }

    // Fetch staff name and client data, then render the chart
    fetchStaffAndClientData();
</script>

</body>
</html>